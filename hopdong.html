<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hợp Đồng - Đức Thành</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <script src="https://unpkg.com/html-docx-js/dist/html-docx.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

    <!-- Thêm các thư viện cần thiết -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/docxtemplater/3.37.11/docxtemplater.js"></script>
    <script src="https://unpkg.com/pizzip@3.1.4/dist/pizzip.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/docxtemplater/3.37.11/docxtemplater.js"></script>
    <script src="https://unpkg.com/pizzip@3.1.4/dist/pizzip.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Times+New+Roman:wght@400;700&display=swap');

        body {
            font-family: 'Times New Roman', Times, serif;
            line-height: 1.3;
            margin: 20px;
            padding: 0;
            color: #000;
        }

        .container {
            max-width: 210mm;
            /* A4 width */
            margin: 0 auto;
            padding: 10mm;
            box-sizing: border-box;
            text-align: justify;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
        }

        .title {
            font-weight: bold;
            font-size: 16pt;
            text-align: center;
            margin: 10px 0;
        }

        .subtitle {
            font-style: italic;
            text-align: center;
            margin: 5px 0;
        }

        .section-title {
            font-weight: bold;
            margin: 15px 0 5px 0;
        }

        .indent {
            margin-left: 20px;
        }

        .double-indent {
            margin-left: 40px;
        }

        p {
            margin: 5px 0;
            padding: 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }

        table,
        th,
        td {
            border: 1px solid #000;
        }

        th,
        td {
            padding: 5px;
            text-align: left;
        }

        .signatures {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }

        .signature-box {
            width: 45%;
            text-align: center;
        }

        .signature-title {
            font-weight: bold;
            margin-bottom: 70px;
        }

        @media print {
            body {
                margin: 0;
                padding: 0;
            }

            .container {
                padding: 0;
                max-width: 100%;
            }

            @page {
                size: A4;
                margin: 10mm;
                padding: 5mm;
            }
        }

        .center {
            text-align: center;
        }

        .trong {
            padding-right: 50mm;
        }

        .product-description {
            display: block;
            margin-top: 5px;
            color: #666;
            white-space: pre-line;
        }

        .product-info {
            text-align: left;
        }

        .product-info strong {
            display: block;
        }

        .product-name {
            text-align: left;
            padding-left: 10px;
        }

        .print-button-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }

        #printButton {
            background-color: #f0a500;
            border: none;
            color: #000;
            padding: 8px 16px;
            font-size: 14px;
            cursor: pointer;
            border-radius: 4px;
            font-family: 'Times New Roman', Times, serif;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        #printButton:hover {
            background-color: #d89400;
        }

        .print-button-container {
            display: flex;
            gap: 10px;
        }

        #exportButton {
            background-color: #2b579a;
            border: none;
            color: #fff;
            padding: 8px 16px;
            font-size: 14px;
            cursor: pointer;
            border-radius: 4px;
            font-family: 'Times New Roman', Times, serif;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        #exportButton:hover {
            background-color: #1e3f6f;
        }

        @media print {
            .print-button-container {
                display: none;
            }
        }
    </style>
</head>

<body>
    <div class="print-button-container">
        <button id="printButton" onclick="window.print()">
            <i class="fas fa-print"></i> In xác nhận
        </button>
        <button id="exportButton" onclick="exportToWordTemplate()">
            <i class="fas fa-file-word"></i> Xuất Word
        </button>
    </div>

    <div class="container">
        <div class="header">
            <p><strong>CỘNG HÒA XÃ HỘI CHỦ NGHĨA VIỆT NAM</strong></p>
            <p><strong>Độc lập -- Tự do -- Hạnh phúc</strong></p>
            <p><strong>*************************</strong></p>
        </div>

        <div class="title">HỢP ĐỒNG KINH TẾ</div>
        <div class="subtitle">Số: <span id="order-number">Đang tải...</span></div>

        <p><em>- Căn cứ Bộ luật Dân sự số 91/2015/QH13 ngày 24/11/2015 và các văn bản pháp luật liên quan;</em></p>
        <p><em>- Căn cứ Luật Thương mại số 36/2005/QH11 ngày 14/06/2005 và các văn bản pháp luật liên quan;</em></p>
        <p><em>- Căn cứ vào khả năng và nhu cầu của hai bên;</em></p>
        <p><em>Hôm nay, ngày <span id="order-date">Đang tải...</span>, tại văn phòng của Công ty, chúng tôi gồm có:</em>
        </p>

        <div class="section-title">1. Bên A (Bên mua) : <span id="customer-name">Đang tải...</span></div>
        <div class="indent">
            <p>Địa chỉ : <span id="invoice-address">Đang tải...</span></p>
            <p>Mã số thuế : <span id="tax-code">Đang tải...</span></p>
            <p>Đại diện : <span class="trong">Ông/Bà </span>Chức vụ:</p>
        </div>

        <div class="section-title">2. Bên B (Bên bán) : CÔNG TY TNHH SẢN XUẤT VÀ DỊCH VỤ ĐỨC THÀNH</div>
        <div class="indent">
            <p>Địa chỉ : Số 9, ngõ 111/12, phố Cầu Cốc, Phường Tây Mỗ, Quận Nam Từ Liêm, Thành phố Hà Nội, Việt Nam</p>
            <p>Mã số thuế : 0108325268</p>
            <p>Đại diện : Ông <strong>Phùng Đức
                    Khoáng</strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                Chức vụ: Giám Đốc</p>
        </div>

        <p>Trên cơ sở thỏa thuận, hai bên thống nhất ký kết hợp đồng kinh tế với các điều khoản như sau:</p>

        <div class="section-title">Điều 1: TÊN HÀNG - SỐ LƯỢNG - QUY CÁCH - GIÁ TRỊ HỢP ĐỒNG</div>
        <p>Bên A đặt Bên B sản xuất sản phẩm theo nội dung như sau:</p>

        <div id="loading">Đang tải dữ liệu...</div>
        <div id="error-message">Có lỗi xảy ra khi tải dữ liệu. Vui lòng thử lại sau.</div>

        <table>
            <thead>
                <tr>
                    <th class="center" width="10%">STT</th>
                    <th class="center" width="37%">HÀNG HÓA</th>
                    <th class="center" width="10%">ĐVT</th>
                    <th class="center" width="10%">SL</th>
                    <th class="center" width="17%">ĐƠN GIÁ</th>
                    <th class="center" width="17%">THÀNH TIỀN</th>
                </tr>
            </thead>
            <tbody id="product-table-body">
                <!-- Dữ liệu sản phẩm sẽ được điền vào đây -->
            </tbody>
            <tfoot id="table-footer">
                <!-- Dữ liệu tổng cộng sẽ được điền vào đây -->
            </tfoot>
        </table>

        <div class="total-in-words">Số tiền viết bằng chữ: <span style="font-weight: bold;" id="total-in-words"> Đang
                tải...</span></div>

        <p>1. Bên B cung cấp sản phẩm hàng hóa cho Bên A phải đảm bảo mới 100% (chưa qua sử dụng) đúng quy cách và chỉ
            tiêu kỹ thuật đảm bảo theo Hợp đồng.</p>
        <p>2. Các yêu cầu về quy cách thành phẩm sẽ được Bên A xác nhận qua email cho Bên B.</p>
        <p>3. Trường hợp có sự thay đổi về sản phẩm, số lượng và/hoặc giá trị thanh toán, Bên B phải thông báo và có sự
            xác nhận đồng ý của Bên A trước khi thực hiện.</p>

        <div class="section-title">Điều 2: THỜI GIAN, ĐỊA ĐIỂM VÀ PHƯƠNG THỨC GIAO HÀNG</div>
        <p>1. Thời gian giao hàng: Trong vòng ... ngày kể từ ngày hai Bên ký kết Hợp đồng, Bên B nhận được tiền tạm ứng
            lầm 1 và file thiết kế chuẩn của Bên A.</p>
        <p>2. Bên B miễn phí giao hàng trong nội thành Hà Nội với các đơn hàng giá trị trên 1.500.000đ.</p>
        <p>3. Địa chỉ giao hàng: Giao nhận Hàng Hóa tại kho/trụ sở do Bên A chỉ định.</p>
        <p>4. Bên A sẽ thông báo cho Bên B thông tin cụ thể của người được ủy quyền đại diện cho Bên A nhận hàng. Hàng
            hóa được coi là đã giao cho Bên A khi và chỉ khi người được Bên A ủy quyền nhận hàng ký vào biên bản giao
            nhận hàng hóa. Các mất mát, hư hỏng của hàng hóa trong quá trình vận chuyển sẽ do Bên B chịu trách nhiệm.
        </p>
        <p>5. Cước phí vận chuyển liên tỉnh: Bên A chịu.</p>
        <p>6. Bên B có trách nhiệm thông báo cho Bên A trước ít nhất 01 (một) ngày trước khi thực hiện giao hàng để Bên
            A bố trí nhân sự nhận và kiểm sản phẩm.</p>
        <p>7. Trong trường hợp Bên B không giao hàng theo đúng tiến độ (chậm tiến độ) theo quy định tại Hợp đồng này,
            Bên B phải chịu phạt 0,1% giá trị Hợp đồng cho mỗi ngày chậm trễ và tổng số tiền bị phạt không vượt quá 8%
            tổng giá trị đơn hàng.</p>

        <div class="section-title">Điều 3: THANH TOÁN</div>
        <p>1. Bên A phải thanh toán cho Bên B giá trị hợp đồng được quy định tại Điều 1 của hợp đồng.</p>
        <p>2. Phương thức thanh toán: Bên A thanh toán cho bên B theo hình thức chuyển khoản vào tài khoản của Bên B chi
            tiết như sau:</p>
        <div class="indent">
            <p>- Tên tài khoản: <strong>CÔNG TY TNHH SẢN XUẤT VÀ DỊCH VỤ ĐỨC THÀNH</strong></p>
            <p>- Số tài khoản: <strong>156939258</strong></p>
            <p>- Mở tại: <strong>Ngân hàng VPBank, Chi nhánh Thăng Long</strong></p>
        </div>

        <p>3. Thời hạn thanh toán:</p>
        <div class="indent">
            <p>- Đợt 1: Bên A thanh toán 50% giá trị hợp đồng cho Bên B trong vòng 01 (một) ngày làm việc kể từ ngày hai
                bên ký hợp đồng. Tương đương với số tiền là <strong>
                    <span id="payment-first-amount"></span>
                </strong> (Bằng chữ: <em><span id="payment-first-words"></span></em>).</p>
            <p>- Đợt 2: Bên A thanh toán 50% giá trị hợp đồng còn lại cho Bên B tương đương số tiền là <strong>
                    <span id="payment-second-amount"></span>
                </strong> (Bằng chữ: <em><span id="payment-second-words"></span></em>) trong 03 (ba) ngày làm việc sau
                khi Bên B bàn giao
                đầy đủ sản phẩm, biên bản bàn giao hàng hóa và hóa đơn GTGT hợp lệ.</p>
        </div>

        <p>4. Trường hợp Bên B chậm cung cấp hồ sơ thanh toán hoặc cung cấp không đầy đủ, chính xác, Bên A có quyền lùi
            thời hạn thanh toán tương ứng mà không phải chịu bất kỳ khoản phạt hay bồi thường nào.</p>
        <p>5. Bên A có trách nhiệm thanh toán đầy đủ, đúng hạn cho Bên B theo Điều 3 của Hợp đồng này. Trường hợp sau 03
            ngày làm việc kể từ khi Bên B đã giao đẩy đủ sản phẩm và cung cấp đầy đủ các chứng từ liên quan theo quy
            định cho Bên A, nếu Bên A không thực hiện việc thanh toán số tiền còn lại mà không thông báo trước và không
            có sự chấp thuận của Bên B, thì mỗi ngày chậm thanh toán sẽ bị phạt là 0,1%/ngày trên giá trị hợp đồng còn
            lại, và tổng số tiền bị phạt không vượt quá 8% tổng giá trị đơn hàng.</p>

        <div class="section-title">Điều 4: KIỂM TRA BÀN GIAO VÀ NGHIỆM THU</div>
        <p>- Nhân sự đại diện hai Bên tiến hành kiểm tra số lượng và chất lượng hàng hoá sau khi giao hàng và nhận hàng.
        </p>
        <p>- Nếu kết quả kiểm tra về số lượng, chủng loại và quy cách hàng hoá chứng tỏ rằng hàng hoá phù hợp với Hợp
            đồng, đại diện giao nhận hàng hai Bên sẽ ký "Biên bản bàn giao hàng hoá" ngay khi hoàn thành kiểm tra hàng
            hóa của Hợp đồng.</p>

        <div class="section-title">Điều 5: TRÁCH NHIỆM CỦA CÁC BÊN</div>
        <div class="section-title indent">1. Trách nhiệm của bên A:</div>
        <div class="double-indent">
            <p>- Đưa ra cho Bên B các yêu cầu; cung cấp mẫu mã, file thiết kế chuẩn và thống nhất duyệt chất liệu và nội
                dung qua email hoặc tin nhắn cho Bên B trước khi thực hiện sản xuất và ngay sau khi có đơn đặt hàng;</p>
            <p>- Bên A chịu trách nhiệm toàn bộ về mặt pháp lý với những hình ảnh và thông tin bên A cung cấp;</p>
            <p>- Đưa ra cho Bên B ý kiến về sản phẩm về Bên B chỉnh sửa cho tới khi đạt được theo đúng yêu cầu của Bên A
                (nếu có);</p>
            <p>- Phối hợp cùng Bên B giải quyết các vấn đề phát sinh trong quá trình thực hiện hợp đồng;</p>
            <p>- Cử đại diện cùng Bên B nhận và kiểm tra chất lượng hàng hoá, lập biên bản giao nhận hàng tại địa điểm
                giao hàng khi Bên B giao hàng.</p>
            <p>- Từ chối nhận hàng và trả lại những sản phẩm hỏng hoặc/và không đạt chất lượng, và/hoặc sai quy cách và
                yêu cầu Bên B khắc phục trong thời hạn do Bên A ấn định mà không phải thanh toán thêm bất kỳ chi phí
                nào;</p>
            <p>- Đảm bảo thanh toán đầy đủ và đúng thời hạn theo thỏa thuận tại Điều 3 của Hợp đồng này cho Bên B;</p>
            <p>- Trường hợp Bên B không thể cung cấp sản phẩm đảm bảo đúng chất lượng yêu cầu của Bên A, Bên A có quyền
                chỉ thanh toán theo đúng giá trị thực tế của sản phẩm bàn giao. Nếu giá trị thanh toán thực tế thấp hơn
                giá trị Bên A đã thanh toán trước, Bên B phải hoàn lại khoản tiền chênh lệch cho Bên A trong 05 (năm)
                ngày làm việc kể từ ngày nhận được thông báo của Bên A.</p>
            <p>- Thực hiện đúng các cam kết được ghi trong Hợp đồng.</p>
            <p>- Có quyền đơn phương chấm dứt hợp đồng mà không phải bồi thường hay thanh toán bất kỳ chi phí nào nếu
                Bên B vi phạm các nghĩa vụ của Hợp đồng này.</p>
            <p>- Toàn bộ nội dung, hình ảnh xuất hiện trên sản phẩm, bao gồm các bản dự thảo và thành phẩm chính thức
                cuối cùng, đều thuộc quyền sở hữu của Bên A. Bên B không được tự ý sử dụng bất kỳ nội dung, hình ảnh nào
                vì bất kỳ mục đích nào khi chưa có sự đồng ý bằng văn bản của Bên A.</p>
        </div>

        <div class="section-title indent">2. Trách nhiệm và quyền hạn của Bên B:</div>
        <div class="double-indent">
            <p>- Bên B đảm bảo sản xuất và chịu trách nhiệm theo đúng mẫu mã, chất liệu, chất lượng đã duyệt dựa trên
                yêu cầu và ý tưởng của Bên A, hạn chế tối thiểu về khả năng sai và lem màu (nếu có). Trường hợp sản phẩm
                được giao không đúng như thỏa thuận, Bên B phải tiến hành khắc phục và thay thế hàng đúng như thỏa
                thuận, yêu cầu của Bên A. Khoản tiền phạt do vi phạm hợp đồng của Bên B sẽ được Bên A khấu trừ trực tiếp
                vào giá trị Hợp đồng trước khi thanh toán cho Bên B.</p>
            <p>- Vận chuyển và giao hàng đúng thời gian, địa điểm, chất lượng và chủng loại theo quy định trong hợp đồng
                này, trừ trường hợp bất khả kháng;</p>
            <p>- Bảo mật tất cả các thông tin, bao gồm nhưng không giới hạn thông tin về Hợp đồng này, tài liệu do Bên A
                cung cấp, các thông tin khác Bên B có được trong quá trình thực hiện Hợp đồng.</p>
            <p>- Cung cấp đầy đủ hóa đơn, chứng từ, tài liệu hợp lệ cho Bên A và chịu trách nhiệm pháp lý về tính hợp lệ
                của các hóa đơn, chứng từ, tài liệu đã giao;</p>
            <p>- Bên B được quyền yêu cầu Bên A thanh toán đầy đủ, đúng hạn theo quy định tại Điều 3 của Hợp đồng này;
            </p>
            <p>- Thực hiện đúng các cam kết được ghi trong Hợp đồng.</p>
            <p>- Nếu Bên B đơn phương chấm dứt hợp đồng mà không có sự đồng ý của Bên A và/ hoặc không do lỗi của Bên A,
                Bên B có trách nhiệm hoàn trả cho Bên A toàn bộ số tiền mà Bên A đã tạm ứng để thực hiện hợp đồng,
                và/hoặc chịu mức phạt cũng như bồi thường thiệt hại.</p>
        </div>

        <div class="section-title">Điều 6: BẤT KHẢ KHÁNG</div>
        <p>1. Sự kiện bất khả kháng là các tình huống, sự kiện khách quan xảy trong thời gian hiệu lực của Hợp đồng mà
            các bên không thể lường trước và không thể tránh khỏi làm cho một và/hoặc các bên không thể thực hiện được
            một phần hoặc toàn bộ nghĩa vụ hợp đồng, ngoại trừ nghĩa vụ thanh toán và/hoặc khó khăn về tài chính của một
            và/hoặc các bên. Sự kiện bất khả kháng bao gồm nhưng không bị giới hạn ở các sự kiện như chiến tranh, khủng
            bố, bạo động, tình trạng khẩn cấp quốc gia, rối loạn công cộng, đình công, bệnh dịch, hỏa hoạn, lũ lụt, động
            đất, thiên tai, thay đổi chính sách pháp luật của Nhà nước, lệnh cấm, trưng mua, trưng dụng của cơ quan nhà
            nước có thẩm quyền và các sự kiện khác có tính chất tương tự;</p>
        <p>2. Trong trường hợp bất khả kháng, một trong các Bên không thể thực hiện được toàn bộ hay một phần nghĩa vụ
            của mình theo Hợp đồng này do Sự kiện bất khả kháng sẽ không bị coi là vi phạm nghĩa vụ hợp đồng. Bên bị ảnh
            hưởng phải nhanh chóng gửi thông báo ngay cho Bên kia trong thời hạn 03 ngày khi nhận thấy rằng mình không
            thể thực hiện được nghĩa vụ do sự kiện bất khả kháng gây ra. Nội dung thông báo phải nêu được thời gian, mức
            độ ảnh hưởng, hậu quả và các biện pháp đã áp dụng để khắc phục sự kiện bất khả kháng. Ngoài ra, Bên bị ảnh
            hưởng bằng khả năng của mình, phải nỗ lực để hạn chế có hiệu quả các thiệt hại do sự kiện bất khả kháng gây
            ra;</p>
        <p>3. Trong trường hợp bất khả kháng, thời gian thực hiện Hợp đồng sẽ được kéo dài thêm một khoảng thời gian
            bằng khoảng thời gian xảy ra trường hợp Bất khả kháng mà Bên bị ảnh hưởng không thể thực hiện các nghĩa vụ
            trong Hợp đồng đã ký. Nếu sau 01 (một) tháng kể từ ngày xảy ra sự kiện bất khả kháng mà Bên bị ảnh hưởng
            không thể khắc phục được thì một trong các bên có quyền gửi thông báo chấm dứt Hợp đồng cho bên kia. Trong
            trường hợp này, việc chấm dứt Hợp đồng sẽ có hiệu lực 15 (mười lăm) ngày sau khi có thông báo.</p>

        <div class="section-title">Điều 7: XỬ LÝ VI PHẠM HỢP ĐỒNG VÀ GIẢI QUYẾT TRANH CHẤP</div>
        <p>1. Trong thời gian hiệu lực của Hợp đồng này, nếu một Bên phát hiện Bên kia vi phạm hợp đồng thì ngay lập tức
            thông báo cho bên vi phạm thông qua các kênh liên lạc, bao gồm nhưng không giới hạn như: bằng văn bản, điện
            thoại, email,... để yêu cầu chấm dứt hành vi vi phạm và khắc phục hậu quả. Đồng thời, bên vi phạm sẽ chịu
            phạt 08% (tám phần trăm) giá trị Hợp đồng và bồi thường thiệt hại (nếu có).</p>
        <p>2. Trong quá trình thực hiện hợp đồng, nếu phát sinh tranh chấp, hai bên có trách nhiệm thông báo kịp thời
            cho nhau biết để cùng nhau thương lượng, giải quyết trên tinh thần hợp tác.</p>
        <p>Trong trường hợp hai bên không tự thương lượng, giải quyết được tranh chấp thì hai bên thống nhất khiếu nại
            đến Tòa án có thẩm quyền của Thành phố Hà Nội để giải quyết theo quy định của pháp luật. Quyết định của Toà
            án sẽ là quyết định cuối cùng. Bên thua kiện phải trả tất cả các chi phí và phí tổn mà bên thắng kiện phải
            chịu trong quá trình giải quyết tranh chấp đó;</p>
        <p>3. Nếu có bất kỳ phát sinh nào trong quá trình thực hiện Hợp đồng mà chưa được quy định trong Hợp đồng này
            thì việc hiểu, giải quyết và áp dụng đối với những phát sinh đó theo quy định của pháp luật Việt Nam.</p>

        <div class="section-title">Điều 8: ĐIỀU KHOẢN CHUNG</div>
        <p>1. Toàn bộ các tài liệu kèm theo hợp đồng, bao gồm nhưng không giới hạn các thông tin trao đổi giữa hai bên
            thông qua email, scan hoặc văn bản được coi là phần không thể tách rời của hợp đồng này;</p>
        <p>2. Hai bên cam kết thực hiện đúng những điều khoản đã thỏa thuận trong hợp đồng này. Mọi sửa đổi, bổ sung,
            điều chỉnh các quy định của hợp đồng chỉ có giá trị sau khi cả hai bên đã nhất trí bằng văn bản;</p>
        <p>3. Không Bên nào được chuyển giao nghĩa vụ trong Hợp đồng này cho bất kỳ một Bên thứ ba nào khác nếu chưa
            được sự đồng ý bằng văn bản của Bên còn lại.</p>
        <p>4. Hợp đồng này cũng như các tài liệu, thông tin liên quan đến hợp đồng sẽ được các bên quản lý theo quy định
            hiện hành của nhà nước về bảo mật. Các Bên có trách nhiệm giữ kín tất cả những thông tin liên quan đến Hợp
            đồng, các thông tin mà mình nhận được từ phía Bên kia trong suốt thời gian hợp tác và ngay cả sau khi Hợp
            đồng chấm dứt, trừ trường hợp được chấp thuận bằng văn bản của Bên kia hoặc do cơ quan quản lý Nhà nước có
            thẩm quyền yêu cầu.</p>
        <p>5. Hợp đồng có hiệu lực kể từ ngày ký và tự động chấm dứt khi hai Bên đã thực hiện xong các trách nhiệm của
            mình theo nội dung của Hợp đồng này trừ nghĩa vụ bảo mật thông tin.</p>
        <p>6. Hợp đồng này được lập thành hai (02) bản gốc có giá trị pháp lý như nhau, Bên A giữ 01 bản, Bên B giữ 01
            bản để thực hiện.</p>

        <div class="signatures">
            <div class="signature-box">
                <div class="signature-title">ĐẠI DIỆN BÊN A</div>
            </div>
            <div class="signature-box">
                <div class="signature-title">ĐẠI DIỆN BÊN B</div>
            </div>
        </div>

    </div>



    <!-- Thêm vào phần head, sau các script hiện có -->
    <script src="https://cdn.sheetjs.com/xlsx-0.19.3/package/dist/xlsx.full.min.js"></script>
    <script src="https://poalninh.github.io/ducthanh/key.js"></script>
    <script>
        // Function to get URL parameters
        function getUrlParameter(name) {
            name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
            var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
            var results = regex.exec(location.search);
            return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
        }

        // Function to format number as currency
        function formatCurrency(number) {
            return number.toLocaleString('vi-VN');
        }

        // Function to format date to Vietnamese format
        function formatDate(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            const day = date.getDate();
            const month = date.getMonth() + 1;
            const year = date.getFullYear();
            return ` ${day} tháng ${month} năm ${year}`;
        }

        // Function to convert number to Vietnamese words
        function numberToWords(num) {
            const units = ['', 'một', 'hai', 'ba', 'bốn', 'năm', 'sáu', 'bảy', 'tám', 'chín'];
            const tens = ['', 'mười', 'hai mươi', 'ba mươi', 'bốn mươi', 'năm mươi', 'sáu mươi', 'bảy mươi', 'tám mươi', 'chín mươi'];
            const scales = ['', 'nghìn', 'triệu', 'tỷ', 'nghìn tỷ', 'triệu tỷ'];

            if (num === 0) return 'không';

            let words = '';
            let scaleIndex = 0;

            while (num > 0) {
                const hundreds = Math.floor(num % 1000 / 100);
                const ten = Math.floor(num % 100 / 10);
                const unit = num % 10;

                let scaleWords = '';

                if (hundreds > 0) {
                    scaleWords += units[hundreds] + ' trăm ';
                }

                if (ten > 1) {
                    scaleWords += tens[ten] + ' ';
                    if (unit > 0) {
                        scaleWords += (unit === 1 && ten > 1) ? 'mốt' : units[unit];
                    }
                } else if (ten === 1) {
                    scaleWords += 'mười ';
                    if (unit > 0) {
                        scaleWords += (unit === 5) ? 'lăm' : units[unit];
                    }
                } else if (unit > 0) {
                    scaleWords += units[unit];
                }

                if (scaleWords) {
                    words = scaleWords + (scaleIndex > 0 ? ' ' + scales[scaleIndex] + ' ' : '') + words;
                }

                num = Math.floor(num / 1000);
                scaleIndex++;
            }

            // Viết hoa chữ cái đầu tiên
            words = words.trim();
            return words.charAt(0).toUpperCase() + words.slice(1) + ' đồng';
        }

        // Get customer data from URL parameters
        function getCustomerFromURL() {
            return {
                'Tên khách hàng đầy đủ': getUrlParameter('customerName') || '',
                'MST': getUrlParameter('taxCode') || '',
                'Địa chỉ Hoá đơn': getUrlParameter('invoiceAddress') || '',
                'SĐT': getUrlParameter('phone') || '',
                'Địa chỉ trả hàng': getUrlParameter('deliveryAddress') || ''
            };
        }

        // Get order data from URL parameters
        function getOrderFromURL() {
            return {
                'ID đơn hàng': getUrlParameter('id') || '',
                'Mã đơn hàng': getUrlParameter('orderCode') || '',
                'Ngày đặt hàng': getUrlParameter('orderDate') || '',
                'Tổng tiền thuế': parseFloat(getUrlParameter('tax')) || 0
            };
        }

        // Hàm tổng hợp để lấy tất cả dữ liệu cần thiết cho hợp đồng
        async function fetchAllData(orderId) {
            const loadingElement = document.getElementById('loading');
            const errorElement = document.getElementById('error-message');

            loadingElement.style.display = 'block';
            errorElement.style.display = 'none';

            try {
                // Nếu không có orderId được truyền vào, lấy từ URL
                if (!orderId) {
                    orderId = getUrlParameter('id');
                    console.log("Getting order ID from URL:", orderId);
                    if (!orderId) {
                        throw new Error('Không tìm thấy mã đơn hàng trong URL');
                    }
                }

                console.log("Fetching data with order ID:", orderId);
                console.log("API settings:", { region, appId });

                // Check for customer and order data in URL first
                const customerFromURL = getCustomerFromURL();
                const orderFromURL = getOrderFromURL();

                // Check if we have complete customer data from URL
                const hasCustomerFromURL = customerFromURL['Tên khách hàng đầy đủ'] !== '';

                // Check if we have complete order data from URL except for products
                const hasOrderFromURL = orderFromURL['Mã đơn hàng'] !== '';

                // Always need to fetch products
                const productsPromise = fetch(`https://${region}.appsheet.com/api/v2/apps/${appId}/tables/Hàng hoá/Action`, {
                    method: 'POST',
                    headers: {
                        'ApplicationAccessKey': accessKey,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        Action: 'Find',
                        Properties: {
                            Selector: `Filter(Hàng hoá, [ID đơn hàng] = "${orderId}")`
                        }
                    })
                });

                // Prepare array of promises
                const promises = [productsPromise];

                // Only fetch order data if not provided in URL
                if (!hasOrderFromURL) {
                    promises.push(
                        fetch(`https://${region}.appsheet.com/api/v2/apps/${appId}/tables/Đơn hàng/Action`, {
                            method: 'POST',
                            headers: {
                                'ApplicationAccessKey': accessKey,
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                Action: 'Find',
                                Properties: {
                                    Selector: `Filter(Đơn hàng, [ID đơn hàng] = "${orderId}")`
                                }
                            })
                        })
                    );
                }

                // Get customerId if available and customer data not provided in URL
                const customerId = getUrlParameter('customerId');
                console.log("Customer ID from URL:", customerId);

                // Only fetch customer data if not provided in URL and we have a customerId
                if (!hasCustomerFromURL && customerId) {
                    promises.push(
                        fetch(`https://${region}.appsheet.com/api/v2/apps/${appId}/tables/Khách hàng/Action`, {
                            method: 'POST',
                            headers: {
                                'ApplicationAccessKey': accessKey,
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                Action: 'Find',
                                Properties: {
                                    Selector: `Filter(Khách hàng, [ID khách hàng] = "${customerId}")`
                                }
                            })
                        })
                    );
                }

                // Execute all promises simultaneously
                const responses = await Promise.all(promises);

                // Check responses
                responses.forEach((response, index) => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status} - Error fetching data (request ${index + 1})`);
                    }
                });

                // Parse responses
                const responseData = await Promise.all(responses.map(response => response.json()));

                // Get data
                const productsData = responseData[0];

                // Order data - either from URL or from API response
                let order;
                if (hasOrderFromURL) {
                    order = orderFromURL;
                } else {
                    const orderData = responseData[1];
                    if (!Array.isArray(orderData) || orderData.length === 0) {
                        throw new Error(`Không tìm thấy đơn hàng với mã: ${orderId}`);
                    }
                    order = orderData.find(o => o['ID đơn hàng'] === orderId);
                    if (!order) {
                        throw new Error(`Không tìm thấy đơn hàng với mã: ${orderId}`);
                    }
                }

                // Customer data - either from URL, from API response, or default
                let customer;
                if (hasCustomerFromURL) {
                    customer = customerFromURL;
                } else if (!hasCustomerFromURL && customerId) {
                    const customerData = responseData[promises.length - 1]; // Last response is customer data
                    if (Array.isArray(customerData) && customerData.length > 0) {
                        const foundCustomer = customerData.find(c => c['ID khách hàng'] === customerId);
                        if (foundCustomer) {
                            customer = foundCustomer;
                        } else {
                            console.warn(`Không tìm thấy khách hàng với ID: ${customerId} trong dữ liệu trả về`);
                            customer = {
                                'Tên khách hàng đầy đủ': 'Khách hàng không xác định',
                                'MST': '',
                                'Địa chỉ Hoá đơn': '',
                                'SĐT': '',
                                'Địa chỉ trả hàng': ''
                            };
                        }
                    } else {
                        customer = {
                            'Tên khách hàng đầy đủ': 'Khách hàng không xác định',
                            'MST': '',
                            'Địa chỉ Hoá đơn': '',
                            'SĐT': '',
                            'Địa chỉ trả hàng': ''
                        };
                    }
                } else {
                    // If no customer data from URL and no customerId, try to get from order
                    const orderCustomerId = order['ID khách hàng'];
                    console.log("Customer ID from order:", orderCustomerId);

                    if (orderCustomerId) {
                        try {
                            const customerResponse = await fetch(`https://${region}.appsheet.com/api/v2/apps/${appId}/tables/Khách hàng/Action`, {
                                method: 'POST',
                                headers: {
                                    'ApplicationAccessKey': accessKey,
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify({
                                    Action: 'Find',
                                    Properties: {
                                        Selector: `Filter(Khách hàng, [ID khách hàng] = "${orderCustomerId}")`
                                    }
                                })
                            });

                            if (customerResponse.ok) {
                                const customerData = await customerResponse.json();
                                console.log("Customer data received from order:", customerData);

                                if (Array.isArray(customerData) && customerData.length > 0) {
                                    const foundCustomer = customerData.find(c => c['ID khách hàng'] === orderCustomerId);
                                    if (foundCustomer) {
                                        customer = foundCustomer;
                                    } else {
                                        customer = {
                                            'Tên khách hàng đầy đủ': 'Khách hàng không xác định',
                                            'MST': '',
                                            'Địa chỉ Hoá đơn': '',
                                            'SĐT': '',
                                            'Địa chỉ trả hàng': ''
                                        };
                                    }
                                } else {
                                    customer = {
                                        'Tên khách hàng đầy đủ': 'Khách hàng không xác định',
                                        'MST': '',
                                        'Địa chỉ Hoá đơn': '',
                                        'SĐT': '',
                                        'Địa chỉ trả hàng': ''
                                    };
                                }
                            } else {
                                console.warn(`Lỗi khi tải dữ liệu khách hàng: ${customerResponse.status}`);
                                customer = {
                                    'Tên khách hàng đầy đủ': 'Khách hàng không xác định',
                                    'MST': '',
                                    'Địa chỉ Hoá đơn': '',
                                    'SĐT': '',
                                    'Địa chỉ trả hàng': ''
                                };
                            }
                        } catch (customerError) {
                            console.warn('Lỗi khi tải dữ liệu khách hàng từ order:', customerError);
                            customer = {
                                'Tên khách hàng đầy đủ': 'Khách hàng không xác định',
                                'MST': '',
                                'Địa chỉ Hoá đơn': '',
                                'SĐT': '',
                                'Địa chỉ trả hàng': ''
                            };
                        }
                    } else {
                        customer = {
                            'Tên khách hàng đầy đủ': 'Khách hàng không xác định',
                            'MST': '',
                            'Địa chỉ Hoá đơn': '',
                            'SĐT': '',
                            'Địa chỉ trả hàng': ''
                        };
                    }
                }

                // Filter products to ensure we only get products for this order
                const products = Array.isArray(productsData) ?
                    productsData.filter(p => p['ID đơn hàng'] === orderId) :
                    [];

                if (products.length === 0) {
                    console.warn(`Không tìm thấy sản phẩm nào cho đơn hàng: ${orderId}`);
                    // Vẫn tiếp tục, không throw error
                }

                return {
                    order,
                    customer,
                    products
                };
            } catch (error) {
                console.error('Failed to fetch data:', error);
                loadingElement.style.display = 'none';
                errorElement.textContent = error.message || 'Có lỗi xảy ra khi tải dữ liệu.';
                errorElement.style.display = 'block';
                throw error;
            }
        }

        // Cập nhật hàm hiển thị sản phẩm để sử dụng dữ liệu từ bảng Hàng hoá
        function displayProducts(products, tableBody, tableFooter, tax = 0) {
            tableBody.innerHTML = '';
            let subtotal = 0;

            if (!products || products.length === 0) {
                tableBody.innerHTML = `
            <tr>
                <td colspan="6" style="text-align: center;">Không có dữ liệu sản phẩm</td>
            </tr>
        `;
                if (tableFooter) {
                    tableFooter.innerHTML = '';
                }
                return 0;
            }

            products.forEach((item, index) => {
                const quantity = parseFloat(item['Số lượng']) || 0;
                const unitPrice = parseFloat(item['Đơn giá']) || 0;
                const total = parseFloat(item['Thành tiền hàng']) || (quantity * unitPrice);
                subtotal += total;

                const row = document.createElement('tr');
                row.innerHTML = `
            <td class="center">${index + 1}</td>
            <td>
                <div class="product-info">
                    <strong>${item['Tên hàng hoá'] || ''}</strong>
                    <span class="product-description">${item['Mô tả'] || ''}</span>
                </div>
            </td>
            <td class="center">${item['Đơn vị tính'] || 'Cái'}</td>
            <td style="text-align: right;">${formatCurrency(quantity)}</td>
            <td style="text-align: right;">${formatCurrency(unitPrice)}</td>
            <td style="text-align: right;">${formatCurrency(total)}</td>
        `;

                tableBody.appendChild(row);
            });

            const grandTotal = subtotal + tax;

            // Tính và hiển thị số tiền thanh toán từng đợt
            const halfAmount = Math.round(grandTotal / 2);

            // Thêm dòng tổng cộng với thuế GTGT
            if (tableFooter) {
                tableFooter.innerHTML = `
            <tr>
                <td colspan="5" style="text-align: center; font-weight: bold;">Cộng tiền hàng</td>
                <td style="text-align: right; font-weight: bold;">${formatCurrency(subtotal)}</td>
            </tr>
            <tr>
                <td colspan="5" style="text-align: center; font-weight: bold;">Thuế GTGT (8%)</td>
                <td style="text-align: right; font-weight: bold;">${formatCurrency(tax)}</td>
            </tr>
            <tr class="total-row">
                <td colspan="5" style="text-align: center; font-weight: bold;">Cộng</td>
                <td style="text-align: right; font-weight: bold;">${formatCurrency(grandTotal)}</td>
            </tr>
        `;
            }

            // Cập nhật số tiền bằng chữ
            document.getElementById('total-in-words').textContent = `${numberToWords(Math.round(grandTotal))}`;
            document.getElementById('payment-first-amount').textContent = formatCurrency(halfAmount) + 'đ';
            document.getElementById('payment-second-amount').textContent = formatCurrency(halfAmount) + 'đ';
            document.getElementById('payment-first-words').textContent = numberToWords(halfAmount);
            document.getElementById('payment-second-words').textContent = numberToWords(halfAmount);

            return grandTotal;
        }

        // Cập nhật hàm displayOrderData để sử dụng dữ liệu từ fetchAllData
        function displayOrderData(data) {
            try {
                const { order, customer, products } = data;
                const tax = parseFloat(order['Tổng tiền thuế']) || 0;

                // Cập nhật thông tin đơn hàng
                document.getElementById('order-number').textContent = order['Mã đơn hàng'] || '';
                document.getElementById('order-date').textContent = formatDate(order['Ngày đặt hàng'] || new Date());

                // Cập nhật thông tin khách hàng
                document.getElementById('customer-name').textContent = customer['Tên khách hàng đầy đủ'] || 'Quý khách hàng';
                document.getElementById('tax-code').textContent = customer['MST'] || '';
                document.getElementById('invoice-address').textContent = customer['Địa chỉ Hoá đơn'] || '';

                // Hiển thị danh sách sản phẩm
                const tableBody = document.getElementById('product-table-body');
                const tableFooter = document.getElementById('table-footer');

                displayProducts(products, tableBody, tableFooter, tax);

            } catch (error) {
                console.error('Error displaying order data:', error);
                document.getElementById('error-message').textContent = 'Lỗi hiển thị dữ liệu đơn hàng: ' + error.message;
                document.getElementById('error-message').style.display = 'block';
            }
        }

        async function exportToWordTemplate() {
            try {
                // Lấy thông tin cơ bản
                const orderNumber = document.getElementById('order-number').textContent;
                const orderDate = document.getElementById('order-date').textContent;
                const customerName = document.getElementById('customer-name').textContent;
                const taxCode = document.getElementById('tax-code').textContent;
                const invoiceAddress = document.getElementById('invoice-address').textContent;
                const totalInWords = document.getElementById('total-in-words').textContent;

                // Lấy thông tin thanh toán
                const paymentFirstAmount = document.getElementById('payment-first-amount').textContent;
                const paymentFirstWords = document.getElementById('payment-first-words').textContent;
                const paymentSecondAmount = document.getElementById('payment-second-amount').textContent;
                const paymentSecondWords = document.getElementById('payment-second-words').textContent;

                // Tính tổng tiền và thuế
                let subtotal = 0;
                const rows = document.querySelectorAll('#product-table-body tr');
                const products = [];

                rows.forEach((row, index) => {
                    const cells = row.cells;
                    if (cells.length === 6) {
                        const cellContent = cells[1].innerHTML;
                        const productDiv = document.createElement('div');
                        productDiv.innerHTML = cellContent;

                        const strongElement = productDiv.querySelector('strong');
                        const descElement = productDiv.querySelector('.product-description');

                        const tenHangHoa = strongElement ? strongElement.textContent.trim() : '';
                        const moTa = descElement ? descElement.textContent.trim() : '';
                        const quantity = parseFloat(cells[3].textContent.trim().replace(/[,.]/g, '')) || 0;
                        const unitPrice = parseFloat(cells[4].textContent.trim().replace(/[,.]/g, '')) || 0;
                        const total = parseFloat(cells[5].textContent.trim().replace(/[,.]/g, '')) || 0;
                        subtotal += total;

                        products.push({
                            stt: (index + 1).toString(),
                            ten_hang_hoa: tenHangHoa,
                            mo_ta: moTa,
                            dvt: cells[2].textContent.trim(),
                            so_luong: formatCurrency(quantity),
                            don_gia: formatCurrency(unitPrice),
                            thanh_tien: formatCurrency(total)
                        });
                    }
                });

                const tax = subtotal * 0.08;
                const grandTotal = subtotal + tax;

                // Lấy template từ server
                const response = await fetch('https://poalninh.github.io/templates/hopdong_template.docx');
                if (!response.ok) {
                    throw new Error('Không thể tải template Word');
                }
                const templateContent = await response.arrayBuffer();

                const zip = new PizZip(templateContent);
                const doc = new window.docxtemplater(zip, {
                    paragraphLoop: true,
                    linebreaks: true
                });

                // Đặt dữ liệu vào template với thông tin thanh toán mới
                const data = {
                    order_number: orderNumber,
                    order_date: orderDate,
                    customer_name: customerName,
                    tax_code: taxCode,
                    invoice_address: invoiceAddress,
                    products: products,
                    subtotal: formatCurrency(subtotal),
                    tax_amount: formatCurrency(tax),
                    grand_total: formatCurrency(grandTotal),
                    total_in_words: totalInWords,
                    // Thêm thông tin thanh toán
                    payment_first_amount: paymentFirstAmount,
                    payment_first_words: paymentFirstWords,
                    payment_second_amount: paymentSecondAmount,
                    payment_second_words: paymentSecondWords
                };

                doc.setData(data);
                doc.render();

                const blob = doc.getZip().generate({
                    type: "blob",
                    mimeType: "application/vnd.openxmlformats-officedocument.wordprocessingml.document"
                });

                const fileName = `Hop_dong_${orderNumber}.docx`;
                saveAs(blob, fileName);

            } catch (error) {
                console.error('Error exporting to Word template:', error);
                if (error.properties && error.properties.errors) {
                    console.log('Template Error details:', error.properties.errors);
                }
                alert('Có lỗi khi xuất file Word. Vui lòng thử lại sau.');
            }
        }

        // Cập nhật hàm khởi tạo trang
        async function initializePage() {
            // Lấy order ID từ tham số URL
            const orderId = getUrlParameter('id');

            if (!orderId) {
                document.getElementById('error-message').textContent = 'Không tìm thấy mã đơn hàng trong URL. Vui lòng kiểm tra lại đường dẫn.';
                document.getElementById('error-message').style.display = 'block';
                document.getElementById('loading').style.display = 'none';
                return;
            }

            try {
                // Fetch all data in one consolidated operation
                const allData = await fetchAllData(orderId);
                console.log('All data loaded:', allData);

                // Display data on the page
                displayOrderData(allData);
            } catch (error) {
                console.error('Failed to initialize page:', error);
                document.getElementById('error-message').textContent = 'Không thể tải dữ liệu đơn hàng. Vui lòng thử lại sau.';
                document.getElementById('error-message').style.display = 'block';
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        }

        // Chạy khi tài liệu đã tải xong
        document.addEventListener('DOMContentLoaded', initializePage);
    </script>
</body>

</html>